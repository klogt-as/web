---
import type { HTMLAttributes } from 'astro/types';

type Props = HTMLAttributes<'a'>;

// Ensure href is always a string (never null/undefined)
const { href = '', class: className, ...props } = Astro.props;

const _href = String(href);

// Base URL from Astro config ("/web/" in production, "/" in dev)
const base_url = import.meta.env.BASE_URL;

// Detect external links (should not get base prefix)
const isExternal =
  _href.startsWith('http://') ||
  _href.startsWith('https://') ||
  _href.startsWith('mailto:') ||
  _href.startsWith('tel:');

// Build the final URL:
// - External links keep their href untouched
// - Internal links are prefixed with the base path
const resolvedHref = isExternal
  ? _href
  : base_url.replace(/\/$/, '') + '/' + _href.replace(/^\//, '');

// Current page path (includes base)
const currentPath = Astro.url.pathname;

// Mark link as active when it matches current page
const isActive =
  !isExternal &&
  (currentPath === resolvedHref ||
    currentPath.startsWith(resolvedHref + '/'));
---

<a href={resolvedHref} class:list={[className, { active: isActive }]} {...props}>
  <slot />
</a>

<style>
  a {
    display: inline-block;
    text-decoration: none;
  }
  a.active {
    font-weight: bolder;
    text-decoration: underline;
  }
</style>
